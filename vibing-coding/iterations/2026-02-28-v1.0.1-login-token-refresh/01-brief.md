# 01 Brief

版本
- 版本号：v1.0.1
- 目标日期：2026-03-05

一句话目标
- H5 登录态更稳：token 过期自动刷新，401 友好提示

问题/背景
- 目前 `wechat-ai-fontend/src/utils/request.ts` 遇到 401 直接抛错，用户无法自恢复。
- `localStorage` 存在 token，但没有统一的刷新与重试机制。
- 后端已有 `POST /api/user/refresh` 能返回新 token。

范围
- 需要做：
- 前端请求层增加 401 刷新与一次性重试
- 登录态读取优先使用本地 token，失败再走 H5 登录
- 对 401/403 给出明确提示
- 不做：
- 不改登录方式与用户体系
- 不改会话与消息业务逻辑

接口或数据变更
- 复用 `POST /api/user/refresh`，返回 `{ token }`
- 不新增接口

风险与依赖
- 依赖后端 refresh 返回结构稳定
- 需要避免刷新死循环（最多重试一次）
- 流式接口（SSE）不做自动重试
